# 虚拟发动机性能监控系统 (EICAS)

## 项目概述

本项目是一个模拟飞机发动机指示和告警系统（Engine Indication and Crew Alerting System, EICAS）的 C++程序。
系统模拟双发动机的运行状态，实时监测各项参数，并在异常情况下发出告警。

## 项目结构

```
Engine/
├── GlobalConstants.h          # 全局配置模块
│   ├── 枚举定义（系统状态、告警级别、故障类型等）
│   ├── 结构体定义（传感器数据、发动机数据、燃油数据等）
│   └── 常量定义（物理参数、阈值、时间参数等）
│
├── EngineSimulator.h/cpp      # 数据仿真引擎模块
│   ├── 物理模拟（转速、温度、燃油的动态变化）
│   ├── 启动/停车逻辑
│   ├── 推力调整
│   └── 故障注入（进阶功能）
│
├── AlertManager.h/cpp         # 告警管理模块
│   ├── 14种异常检测
│   ├── 告警级别判断
│   ├── 告警生命周期管理
│   └── 告警消息生成
│
├── EngineUI.h/cpp            # 图形界面模块
│   ├── 表盘绘制（N1转速表、EGT温度表）
│   ├── 数字显示
│   ├── 状态指示器（START/RUN灯）
│   ├── 按钮交互
│   └── 告警消息显示
│
├── Logger.h/cpp              # 日志与数据持久化模块
│   ├── CSV数据记录（每5ms）
│   ├── Log事件记录
│   └── 文件管理
│
├── main.cpp                  # 主控程序
│   ├── 系统初始化
│   ├── 主循环（5ms更新周期）
│   ├── UI刷新（30Hz）
│   └── 事件处理
│
└── README.md                 # 本文件
```

## 模块说明

### 1. GlobalConstants.h - 全局配置模块

**职责**：定义整个项目共享的枚举、结构体和常量

**关键内容**：

- `SystemState`：OFF, STARTING_P1, STARTING_P2, RUNNING, STOPPING
- `AlertLevel`：NORMAL, ADVISORY, CAUTION, WARNING, INVALID
- `EngineData`：包含 N1、EGT 及双传感器数据
- `FuelData`：燃油余量和流速
- 物理参数常量（额定转速、温度范围、告警阈值等）

### 2. EngineSimulator - 数据仿真引擎

**职责**：模拟发动机物理行为

**核心功能**：

- `update(dt)`：每 5ms 更新一次，根据状态执行不同物理公式
- `startEngine()`：启动序列（2 秒线性 + 对数增长至 95%额定转速）
- `stopEngine()`：停车序列（10 秒内对数下降至 0）
- `adjustThrust()`：推力调整（影响 V、N1、EGT）

**物理公式**：

- 启动阶段 2：N = 23000·lg(t-1) + 20000
- 启动阶段 2：T = 900·lg(t-1) + T₀
- 启动阶段 2：V = 42·lg(t-1) + 10

### 3. AlertManager - 告警管理模块

**职责**：检测异常并管理告警

**14 种异常类型**：

**传感器故障**（6 种）：

1. 单个 N1 传感器故障 - 白色告警
2. 单发 N1 双传感器故障 - 琥珀色告警
3. 单个 EGT 传感器故障 - 白色告警
4. 单发 EGT 双传感器故障 - 琥珀色告警
5. 双发 N1 传感器故障 - 红色告警 + 停车
6. 双发 EGT 传感器故障 - 红色告警 + 停车

**燃油异常**（3 种）： 7. 燃油余量低（< 1000）- 琥珀色告警 8. 燃油传感器故障 - 红色告警 9. 燃油流速超限（> 50）- 琥珀色告警

**转速异常**（2 种）： 10. 超转 1（N1 > 105%）- 琥珀色告警 11. 超转 2（N1 > 120%）- 红色告警 + 停车

**温度异常**（4 种）： 12. 启动超温 1（T > 850℃）- 琥珀色告警 13. 启动超温 2（T > 1000℃）- 红色告警 + 停车 14. 稳态超温 3（T > 950℃）- 琥珀色告警 15. 稳态超温 4（T > 1100℃）- 红色告警 + 停车

**告警规则**：

- 告警显示持续 5 秒
- 5 秒内同一告警只记录一次日志
- 颜色编码：白色（正常/建议）、琥珀色（警戒）、红色（警告）

### 4. EngineUI - 图形界面模块

**职责**：绘制界面并处理用户交互

**界面元素**：

- **N1 表盘**：左右发动机转速表（0-125%，0-210 度扇形）
- **EGT 表盘**：左右发动机温度表（0-1200℃，0-210 度扇形）
- **数字显示**：精确数值显示
- **状态指示器**：START 灯、RUN 灯
- **按钮**：START、STOP、增加推力、减小推力
- **告警消息区**：右侧显示英文告警文字

**颜色方案**：

- 正常：白色
- 警戒：琥珀色（#FFBF00）
- 警告：红色
- 无效：灰色（显示"--"）

**注意**：当前使用抽象绘图接口，实际使用时需要适配具体图形库（EasyX/Qt/OpenGL）

### 5. Logger - 日志与数据持久化模块

**职责**：记录数据和事件

**文件格式**：

- **CSV 文件**：`EICAS_YYYYMMDD_HHMMSS.csv`
  - 每 5ms 记录一次
  - 包含：时间戳 + 所有传感器原始数据
  - 列：Time, L_N1_S1, L_N1_S2, ..., Fuel_Capacity, Fuel_FlowRate
- **Log 文件**：`EICAS_YYYYMMDD_HHMMSS.log`
  - 记录告警事件
  - 格式：[HH:MM:SS.mmm] MESSAGE
  - 5 秒内同一告警只记录一次

### 6. main.cpp - 主控程序

**职责**：程序入口和主循环管理

**主循环结构**（5ms 周期）：

1. 更新仿真引擎：`simulator->update(0.005)`
2. 检测告警：`alertManager->checkCondition(data)`
3. 记录数据：`logger->recordData(timestamp, data)`
4. 更新 UI：`ui->update(data, alerts)`（30Hz）
5. 处理输入事件

## 开发计划

### 当前状态

✅ **框架搭建完成**

- 所有模块的头文件和源文件已创建
- 函数接口已定义
- 数据结构已设计

### 下一步工作

⬜ **实现各模块的 TODO 部分**

1. EngineSimulator：实现物理公式和状态机逻辑
2. AlertManager：实现 14 种异常检测算法
3. EngineUI：选择并适配图形库（推荐 EasyX）
4. Logger：实现文件 I/O 和时间戳格式化
5. main.cpp：实现初始化和主循环逻辑

⬜ **测试与调试**

- 单元测试各模块功能
- 集成测试系统整体运行
- 性能优化（确保 5ms 周期稳定）

⬜ **进阶功能**

- 故障注入测试
- 多种异常组合测试
- UI 美化和用户体验优化

## 编译说明

### 依赖项

- C++17 或更高版本
- 图形库（三选一）：
  - **EasyX**（推荐，Windows 平台）
  - **Qt5/Qt6**（跨平台）
  - **OpenGL + GLFW**（跨平台）

### 编译命令（待实现具体图形库后完善）

**使用 g++（示例）**：

```bash
g++ -std=c++17 -o EICAS main.cpp EngineSimulator.cpp AlertManager.cpp EngineUI.cpp Logger.cpp -leasyx
```

**使用 CMake（推荐）**：

```bash
mkdir build
cd build
cmake ..
cmake --build .
```

## 使用说明

1. **启动程序**：运行生成的可执行文件
2. **启动发动机**：点击 START 按钮
3. **观察仪表**：
   - N1 转速表逐渐上升
   - EGT 温度表逐渐上升
   - START 灯亮起
   - 达到 95%后 RUN 灯亮起
4. **调整推力**：点击"INCREASE THRUST"或"DECREASE THRUST"
5. **停止发动机**：点击 STOP 按钮（最高优先级）
6. **查看日志**：程序退出后查看 CSV 和 Log 文件

## 数据有效范围

- **燃油余量 C**：0 ~ 20000 单位（满油 20000）
- **燃油流速 V**：0 ~ 50 单位/秒
- **转速百分比 N1**：0 ~ 125%（额定转速 40000 转/分）
- **排气温度 T**：-5 ~ 1200℃（初始温度 20℃）

## 物理过程说明

### 启动阶段

1. **阶段 1（0-2 秒）**：线性增长

   - N1：10,000 转/秒
   - 燃油流速：5 单位/秒 ²

2. **阶段 2（2 秒-达到 95%）**：对数增长
   - 使用对数函数模拟真实启动曲线
   - 直到 N1 达到 95%额定转速

### 稳定阶段

- N1、T、V 保持基本稳定
- 可有 ±3%随机波动

### 停车阶段

- 燃油流速立即归零
- N1 和 T 以对数方式下降
- 10 秒内完全停止

## 注意事项

1. **代码规范**：

   - 所有 TODO 标记的函数需要逐一实现
   - 保持代码风格一致
   - 添加必要的错误处理

2. **性能要求**：

   - 确保 5ms 更新周期稳定
   - UI 刷新频率可降低至 30Hz
   - 避免在主循环中进行耗时操作

3. **文件命名**：

   - 日志文件自动以时间戳命名
   - 每次运行创建新文件，不覆盖旧数据

4. **图形库适配**：
   - EngineUI 中的绘图函数需要根据选择的库进行实现
   - 推荐使用 EasyX（简单易用，适合 Windows）
   - 或使用 Qt（跨平台，功能丰富）

## 作者备注

这是一个高度模块化的设计，各模块职责清晰、接口明确。

**设计优势**：

- ✅ 低耦合：模块间通过数据结构通信
- ✅ 高内聚：每个模块功能单一明确
- ✅ 易扩展：添加新功能无需大幅修改现有代码
- ✅ 易测试：每个模块可独立测试

**后续实现建议**：

1. 先实现 EngineSimulator 的基础物理模型
2. 再实现 Logger，确保数据可记录
3. 然后实现 AlertManager，验证异常检测
4. 最后实现 EngineUI，完成用户交互

祝开发顺利！🚀
